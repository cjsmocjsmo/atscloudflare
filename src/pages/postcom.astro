---
import Layout from "../layouts/Layout.astro";
import HomeBtn from "../components/HomeBtn.astro";
import ComCard from "../components/ComCard.astro";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    console.log(data);
    const name_raw = data.get("name");
    let name_str = name_raw.toString();
    let name = name_str.trim();

    const email_raw = data.get("email");
    let email_str = email_raw.toString();
    let email = email_str.trim();

    const comment_raw = data.get("comment");
    let comment_str = comment_raw.toString();
    let comment = comment_str.trim();
    
    const rating = data.get("rating");
    const http1 = "https://atstest.xyz/addcom/" + name + "/" + email + "/" + comment + "/" + rating;
    const http2 = encodeURI(http1);
    console.log(http2);
    const res = await fetch(http2);
    const json = await res.json();
    console.log(json);
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
// let visible = false;
---

<Layout title="Comments">
    <HomeBtn />
    <main>
        <ComCard
            name="Sophie H."
            date="July 19, 2022"
            stars="5"
            comment=`Honest;punctual;immaculate workmanship;cautious;great demeanor;
            accommodating;&all around FIVE STARS IR MORE IF THERE’s such a thing❣️I’d 
            recommend this crew to anyone needing tree services.The owner me.Curtis 
            McBride is truly an honorable and very capable gentleman.`
        />
        <ComCard
            name="John K."
            date="September 22, 2020"
            stars="5"
            comment=`Great work and excellent clean up.`
        />
        <p class="leaveCom">Please Leave A Comment</p>
        <div class="mainDiv">
            <!-- <button class="showForm">Send A Comment</button> -->
        
            <form method="POST" class="comDiv w-full max-w-sm">
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-name"
                        >
                            Name
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="name"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-name"
                            type="text"
                            value="Jane Doe"
                        />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-email"
                        >
                            EMail
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="email"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-email"
                            type="email"
                            placeholder="jandoe@gmail.com"
                            required
                        />
                    </div>
                </div>
                <!-- <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-password"
                        >
                            EMail
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="email"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-email"
                            type="email"
                            placeholder="jandoe@gmail.com"
                            required
                        />
                    </div>
                </div> -->
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-rating"
                        >
                            Rating
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                        name="rating"
                        class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                        id="inline-rating"
                        type="text"
                        placeholder="1-5"
                        required
                    />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-comment"
                        >
                            Comment
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <textarea
                            name="comment"
                            rows="5"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-comment"
                            placeholder="Comment"
                            required >
                        </textarea>
                    </div>
                </div>

                <div class="md:flex md:items-center">
                    <div class="md:w-1/3"></div>
                    <div class="md:w-2/3">
                        <button
                            class="shadow bg-purple-500 hover:bg-purple-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded"
                            type="submit"
                        >
                            Submit
                        </button>
                    </div>
                </div>
            </form>
            
        </div>
    </main>
</Layout>

<style>
    .leaveCom {
        text-align: center;
        font-size: 1.75rem;
        margin-top: 2rem;
        color: purple;
    }
    .mainDiv {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-top: 2rem;
    }
    h1 {
        text-align: center;
    }
    main {
        margin: auto;
        padding: 1rem;
        width: 800px;
        max-width: calc(100% - 2rem);
        color: white;
        font-size: 20px;
        line-height: 1.6;
        min-height: 100vh;
    }
</style>
