---
import Layout from "../layouts/Layout.astro";
import HomeBtn from "../components/HomeBtn.astro";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    console.log(data);
    const name_raw = data.get("name");
    let name_str = name_raw.toString();
    let name = name_str.trim();

    const address_raw = data.get("address");
    let address_str = address_raw.toString();
    let address = address_str.trim();

    const city_raw = data.get("city");
    let city_str = city_raw.toString();
    let city = city_str.trim();

    const phone_raw = data.get("phone");
    let phone_str = phone_raw.toString();
    let phone = phone_str.trim();

    const email_raw = data.get("email");
    let email_str = email_raw.toString();
    let email = email_str.trim();

    const reqdate_raw = data.get("reqdate");
    let reqdate_str = reqdate_raw.toString();
    let reqdate = reqdate_str.trim();

    const comment_raw = data.get("comment");
    let comment_str = comment_raw.toString();
    let comment = comment_str.trim();
    
    const rating = data.get("rating");
    const http1 = "https://atstest.xyz/addesti/";
    let http2 = http1 + name + "/" + address + "/" + city
    let http3 = http2 + "/" + phone + "/" + email + "/" + comment + "/" + reqdate;
    let http4 = encodeURI(http3);
   
    console.log(http4);
    const res = await fetch(http4);
    const json = await res.json();
    console.log(json);
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}

---

<Layout title="Comments">
    <HomeBtn />
    <main>
        <div class="mainDiv">
           
        
            <form method="POST" class="w-full max-w-sm">
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-name"
                        >
                            Name
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="name"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-name"
                            type="text"
                            value="Herman Munster"
                        />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-address"
                        >
                            Address
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="address"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-address"
                            type="text"
                            placeholder="1313 Mockingbird Lane"
                            required
                        />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-city"
                        >
                            City
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="city"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-city"
                            type="text"
                            placeholder="Mockingbird Heights"
                            required
                        />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-phone"
                        >
                            Phone
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                        name="phone"
                        class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                        id="inline-phone"
                        type="text"
                        placeholder="666-555-5555"
                        required
                    />
                    </div>
                </div>
                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-email"
                        >
                            Email
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="email"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-email"
                            type="text"
                            placeholder="herman@monster.com"
                            required
                        />
                    </div>
                </div>

                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-serdate"
                        >
                            Service Date
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <input
                            name="reqdate"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-reqdate"
                            type="text"
                            placeholder="01-20-2024"
                            required
                        />
                    </div>
                </div>

                <div class="md:flex md:items-center mb-6">
                    <div class="md:w-1/3">
                        <label
                            class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4"
                            for="inline-comment"
                        >
                            Comment
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        <textarea
                            name="comment"
                            rows="5"
                            class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500"
                            id="inline-comment"
                            placeholder="Explain Problem Here"
                            required >
                        </textarea>
                    </div>
                </div>

                <div class="md:flex md:items-center">
                    <div class="md:w-1/3"></div>
                    <div class="md:w-2/3">
                        <button
                            class="shadow bg-purple-500 hover:bg-purple-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded"
                            type="submit"
                        >
                            Submit
                        </button>
                    </div>
                </div>
            </form>
            
        </div>
    </main>
</Layout>

<style>
    .mainDiv {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    h1 {
        text-align: center;
    }
    main {
        margin: auto;
        padding: 1rem;
        width: 800px;
        max-width: calc(100% - 2rem);
        color: white;
        font-size: 20px;
        line-height: 1.6;
        min-height: 100vh;
    }
</style>
